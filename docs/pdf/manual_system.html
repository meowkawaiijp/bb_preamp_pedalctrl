<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>システム設定・MIDI - Presettable BB-Preamp Controller</title>
    <link rel="stylesheet" href="style.css">
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>システム設定・MIDI</h1>
            <p>System Configuration & MIDI Control</p>
        </header>

        <nav class="nav">
            <a href="index.html">はじめに</a>
            <a href="manual_basic.html">基本操作</a>
            <a href="manual_presets.html">プリセット管理</a>
            <a href="manual_wifi_webui.html">WiFi・Webエディタ</a>
            <a href="manual_system.html">システム設定・MIDI</a>
        </nav>

        <section class="card">
            <h2>モード切り替えマップ</h2>
            <p><strong>ENTER ボタン</strong>を長押しすると「Change Mode」画面に入り、以下の機能にアクセスできます。</p>
            
            <div class="mermaid">
            graph LR
                Play[Play Mode] -->|長押し| Change[Change Mode]
                
                Change -->|選択| PlayBack[Play Mode<br>(演奏に戻る)]
                Change -->|選択| Settings[Settings<br>(システム設定)]
                Change -->|選択| ShowURI[Show URI<br>(IPアドレス確認)]
                Change -->|選択| EditSSID[Edit SSID<br>(WiFi設定)]
                Change -->|選択| EditPASS[Edit PASS<br>(WiFi設定)]
            </div>
        </section>

        <section class="card">
            <h2>設定項目 (Settings)</h2>
            <p>Change Modeから「Settings」を選択すると、以下の項目を設定できます。設定変更後はENTERボタンで保存され、Play Modeに戻ります。</p>

            <table>
                <thead>
                    <tr>
                        <th>設定項目</th>
                        <th>値の範囲</th>
                        <th>説明</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>MIDI CH</strong></td>
                        <td>1 〜 16</td>
                        <td>MIDI受信チャンネルを設定します。</td>
                    </tr>
                    <tr>
                        <td><strong>FootSW Mode</strong></td>
                        <td>Preset / Alternate</td>
                        <td>
                            <strong>Preset:</strong> 押すたびにプリセットを順に切り替えます。<br>
                            <strong>Alternate:</strong> エフェクトのON/OFFを切り替えます。
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Preset Max</strong></td>
                        <td>2 〜 9</td>
                        <td>フットスイッチで切り替えるプリセットの最大数を制限します（例: 3に設定すると0→1→2→0...とループ）。</td>
                    </tr>
                    <tr>
                        <td><strong>WiFi Enable</strong></td>
                        <td>ON / OFF</td>
                        <td>WiFi機能の有効/無効を切り替えます。ONに切り替えると再起動を促されます。</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section class="card">
            <h2>MIDIコントロール</h2>
            <p>本機は外部MIDI機器からの<strong>プログラムチェンジ (Program Change)</strong> メッセージを受信してプリセットを切り替えることができます。</p>
            
            <div class="mermaid">
            sequenceDiagram
                participant MIDI as 外部MIDIコントローラー
                participant BBP as BB-Preamp Ctrl
                
                MIDI->>BBP: Program Change #3 (Ch.1)
                Note right of BBP: MIDI CH設定が一致すれば受信
                BBP->>BBP: Preset #3 をロード
                BBP-->>BBP: 画面と音色を更新
            </div>

            <ul>
                <li><strong>受信メッセージ:</strong> Program Change (0xCn)</li>
                <li><strong>対応番号:</strong> 0 〜 9 (プリセット 0 〜 9 に対応)</li>
            </ul>
            <div class="info-box">
                設定したMIDIチャンネルと同じチャンネルのメッセージのみを受信します。
            </div>
        </section>

        <footer>
            <a href="index.html">目次へ戻る</a>
        </footer>
    </div>
</body>
</html>
